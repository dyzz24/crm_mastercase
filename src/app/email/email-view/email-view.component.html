<div class="preload_container" *ngIf="this.preload_to_wait_status === true; else view_letter">
    <div class="cssload-speeding-wheel"></div>
  <p>Загрузка</p>
</div>

<ng-template #view_letter >

<div class="container__view" #printBlock>
  <div class="header_letter__view">
    <div class="group__one">

        <button class='new__mess' (click)='this.emailServ.new_clear_message()'
        routerLink="./create"
        >
            <span class='la la-envelope-o'></span>
            <p class="tooltip">Новое сообщение</p>
          </button>
          <button (click)='selectMess(-1)' 
          >
              <span class='la la-angle-left' ></span>
              <p class="tooltip">Следующее сообщение</p>
            </button>
              <button  (click)='selectMess(1)'>
                  <span class='la la-angle-right'></span>
                  <p class="tooltip">Предыдущее сообщение</p>
                </button>
   
    <div class="left__panel">
  <button class='menu' (click)="this.emailServ.newMessage(this.selectedLetter?.from_address,'',this.selectedLetter?.subject, true, [])"
  routerLink="./create"
  >
    <span class='la la-mail-reply'></span>
    <p class="tooltip">Ответить</p>
</button>
<button class='menu' 
(click)='this.emailServ.newMessage(this.selectedLetter?.from_address, this.selectedLetter?.recipients.to, this.selectedLetter?.subject, true, [])'
[class.none_display] = 'this.selectedLetter?.recipients.to.length === 1'
routerLink="./create"
>
  <span class='la la-reply-all'></span>
  <p class="tooltip">Ответить всем</p>
</button>
<button class='menu' (click)="this.emailServ.new_forward_message(this.selectedLetter?.text, this.selectedLetter?.html)"
routerLink="./create"
>
  <span class='la la-share'></span>
  <p class="tooltip">Переслать</p>
</button>
    </div>
  <button class='menu' (click)='deleteLetter()'>
   <span class='la la-trash-o'></span>
  <p class="tooltip">Удалить сообщение</p>
  </button>
</div>
<div class="group__one">
    <div class="left__panel end">
      <button class='one_butt' (click)='hideMenuShow()'>
      <span class='la la-ellipsis-h'></span>
      <div class="hideMenu" [ngClass]='{visible: visibleMenu}'>
        <button class='letterMenuButt' (click)='print()'>Распечатать</button>
        <button class='letterMenuButt' (click)='preserv_saver()'>Сохранить в закладках</button>
      </div>
      <p class="tooltip">Меню</p>
    </button>
  </div>

    <button class='one_butt' (click)='closeViewer()'
    >
        <span class='la la-close'></span>
        <p class="tooltip">Закрыть</p>
      </button>

  </div>
  </div>
  <div class="subject"><p class='subject__theme'>Тема: {{this.selectedLetter?.subject}}</p>
     
         <div class='left__panel end' *ngIf="this.selectedLetter?.work_user_id !== null">
          <div class='in_work' [class.in_work_not-me]="this.selectedLetter?.work_user_id.userId !== this.authorizationServ.userId" ><p>{{this.selectedLetter?.work_user_id.firstName}} {{this.selectedLetter?.work_user_id.lastName}}</p>
          </div>
        </div>
      
  </div>
  <div class="messageContainer" #messageContainer>


  <div class="mess__content">
    
    <div class="mess__content_body">
        <div class="mess__info">
          <div class="avatar__block">
            <div class="avatar">
              <!-- <img src={{emailServ.avatar}}> -->
              <p class='avatar__title'>{{this.selectedLetter?.from_address.charAt(0)}}</p>
            </div>
          </div>
            <div class="r__info">
            <div class="panel">
              <div class='panel__name'>
                
                <p class='full_name' *ngIf="this.selectedLetter?.from_name !== ''">{{this.selectedLetter?.from_name}}</p>
                <p class='email__name'>{{this.selectedLetter?.from_address}}</p>
              </div>
          <p class='time'>{{this.selectedLetter?.date | timerPipe}}</p>
            </div>
            <div class="info__row">
              <p class="info_head">Кому: </p>
              <div class="cut__visible_block">
              <div class='info__content_p' *ngIf="this.selectedLetter?.recipients.to.length === 1; else have_many_addresses"><p>Вам</p></div>
              <ng-template #have_many_addresses>
              <div class='info__content_p' *ngFor="let item of this?.cut_addressess_array"><p>{{item.address}}</p></div>
              <input type='button' class='addressess' [class.input_return]='this?.cut_addressess_array.length === this.selectedLetter?.recipients.to.length'
              *ngIf="this.selectedLetter?.recipients.to.length > 3"
              (click)='all_view($event)' 
              value='+{{this.selectedLetter?.recipients.to.length - this?.cut_addressess_array.length}}'>
              </ng-template>
            </div>
            </div>
            <div class="info__row" *ngIf="this.selectedLetter?.recipients.cc !== undefined">
                <p class="info_head">Копия:</p>
                <div class="cut__visible_block">
                <div class='info__content_p' *ngFor="let item of this?.cut_cc_adressess_array"><p>{{item.address}}</p></div>
                <input type='button' class='cc' [class.input_return]='this?.cut_cc_adressess_array.length === this.selectedLetter?.recipients.cc.length'
                *ngIf="this.selectedLetter?.recipients.cc.length > 3"
                (click)='all_view($event)' 
                value='+{{this.selectedLetter?.recipients.cc.length - this?.cut_cc_adressess_array.length}}'>
                </div>
            </div>
        </div>
          </div>
          <div class="attachment__block" *ngIf="this.selectedLetter?.attachments !== false">
            <div class="attach__container">
              <div class="attachment__item" *ngFor="let attach of this.selectedLetter?.recipients.attachments; let i = index">
              <span [class]='attach.name | attachPipe'></span>
              <p class='filename'>{{attach.name}}
               
              </p>
              
              <p class='size'>{{attach.size}}</p>
               <p class="attach_tooltip">{{attach.name}}</p>
              </div>
              
            </div>
            <button class='download' >
                <span class='la la-download'></span>
                <p class="tooltip">Скачать всё</p>
              </button>
        
            </div>
    
    <div [innerHTML]="this.selectedLetter?.html | innerhtml" *ngIf="this.selectedLetter?.html !== null; else viewText" class='cont_html'></div>
    <ng-template #viewText >
    <div class='cont_html'>{{this.selectedLetter?.text}}</div>
  </ng-template>
  </div>
</div>
<div class="quickResponse quickResponse__active" [ngClass]='{quickResponse__active: quickResponse_active}'>
    <div class="avatar__block" [ngClass]='{avatar__active: quickResponse_active}'>
  <div class="avatar">
    <p class='avatar__title'>{{this.emailServ.idPostForHTTP.charAt(0)}}</p>
  </div>
</div>
<div class="quickResponse__content">
    <div class="quickResponse__panel" [ngClass]='{panel__active: quickResponse_active}'>
        <div class="info__row">
            <p class='info_head'>Кому: </p>
            <div class='info__content_p mrg_off'><p>{{this.selectedLetter?.from_address}}</p></div>
        </div>
        <button class='one_butt' (click)='show_quick_form(true)'>
            <span class='la la-min la-close'></span>
        </button>
        
  </div>
  <textarea  class='quickResponse__inp' 
  placeholder="Написать быстрый ответ" 
  [ngClass]='{inp__active: quickResponse_active}' 
  (click)='show_quick_form(false)'
  [(ngModel)]='messages'
  #input_cleaner></textarea>
  <div class="quickResponse__panel" [ngClass]='{panel__active: quickResponse_active}'>
    <div class="panel__left">
    <button class='button__send' (click)='quick_send($event)'><span>Отправить</span></button>
    <div class="left__panel end">
    <button>
        <span class='la la-paperclip visible'></span>
        <input type='file' class='quickResponse__files_btn' multiple (change)='onFileChange($event)'>
      </button>
    </div>

          <p class='btn__text'
          (click)="this.emailServ.newMessage(this.selectedLetter?.from_address,'',this.selectedLetter?.subject, false, [])"
          routerLink="./create"
          >Перейти в полную версию</p>
  </div>
  <button class='one_butt'>
      <span class='la la-ellipsis-h'></span>
    </button>
</div>

<div class="quickResponse__mail_status" *ngIf="this.sending_status === true">
  <p>Письмо отправляется</p>
</div>
</div>
</div>
</div>
</div>
<app-preserver></app-preserver>
</ng-template>